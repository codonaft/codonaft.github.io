---
permalink: /searxng
---

<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<link rel="icon" href="https://searx.space/favicon.png" sizes="any">
<link rel="icon" href="https://searx.space/favicon.svg" type="image/svg+xml">
<link rel="apple-touch-icon" href="https://searx.space/favicon.png">
<title>Minimalist SearXNG Redirector</title>
<style>
code { background-color: rgba(128, 128, 128, 0.4); padding: 0.1rem 0.25rem 0.1rem 0.25rem }
.pale { color: #808080 }
</style>
</head>
<body>
<script type="module">
import { detectAll } from '{{ site.url }}/assets/js/vendor/tinyld.min.js';

const INSTANCES_URL = 'https://searx.space/data/instances.json';
const INSTANCES = ['search.charliewhiskey.net', 'search.im-in.space', 'search.ipsys.bf', 'search.mycotrip.tech', 'search.ononoki.org', 'search.pollorebozado.com', 'search.rowie.at', 'search.system51.co.uk', 'search.undertale.uk', 'search.url4irl.com', 'searx.bndkt.io', 'searx.dresden.network', 'searx.foss.family', 'searx.oloke.xyz', 'searx.ox2.fr', 'searx.party', 'searx.perennialte.ch', 'searx.tiekoetter.com', 'searx.zhenyapav.com', 'searxng.shreven.org']
const LANGUAGES = ['en'];
const TIMEOUT = 5000;
const ATTEMPTS = 10;
const CUSTOM_PARAMS = ['attempts', 'languages', 'fast', 'instances', 'timeout'];
const STATS_KEY = 'searxngRedirectorStats';
const STATS_TTL_SECS = 24 * 60 * 60;

const tasks = [];
const schedule = (f, pause) => tasks.push(setTimeout(f, pause));
const cancelTasks = _ => {
 tasks.forEach(clearTimeout);
 tasks.length = 0;
};

const currentTime = _ => Math.round(Date.now() / 1000);

const loadAndShuffleInstances = async params => {
 const attempts = Number(params.get('attempts')) || ATTEMPTS;
 const instancesFromParams = params.get('instances')?.split(',') || [];
 const instances = shuffle((instancesFromParams.length > 0 ? instancesFromParams : INSTANCES))
  .slice(0, attempts)
  .map(i => {
   const protocol = i.endsWith('.onion') ? 'http' : 'https';
   return `${protocol}://${i}/`;
  });
 if (params.get('fast') === '1') return instances;

 const response = await fetch(INSTANCES_URL);
 if (!response.ok) {
  console.log('failed to load instances');
  return instances;
 }

 const loadedInstances = (await response.json()).instances;
 console.log('instances', loadedInstances);

 const searxngRedirectorStats = JSON.parse(localStorage.getItem(STATS_KEY) || '{}');
 console.log('stats', searxngRedirectorStats);
 const onion = window.location.host.endsWith('.onion');
 const best = Object
  .entries(loadedInstances)
  .filter(([u, i]) => {
   try {
    const url = new URL(u);
    if (onion) {
     if (i?.network_type !== 'tor') return false;
    } else {
     if (i?.network_type !== 'normal' || url.protocol !== 'https:' || i?.tls?.grade !== 'A+' || i?.html?.grade !== 'V') return false;
    }
    return !i?.analytics;
   } catch(e) {
    console.error(e);
    return false;
   }
  })
  .map(([u, i]) => {
    const s = searxngRedirectorStats[u.hostname];
    const localOkRate = (s && s.ttl > currentTime()) ? (s.ok + 1) / (s.failures + 1) : 1;
    const key = [localOkRate, i?.uptime?.uptimeDay, i?.uptime?.uptimeMonth, 1 / i?.engines?.google?.error_rate, 1 / i?.engines?.duckduckgo?.error_rate];
    return [u, key];
  })
  .sort(([_a, a], [_b, b]) =>  {
   const index = a.findIndex((_, i) => (a[i] || 0) !== (b[i] || 0));
   if (index === -1) return 0;
   return b[index] - a[index];
  })
  .map(([u, _]) => u)
  .slice(0, attempts);

 console.log('best', best);
 if (best.length === 0) {
  console.log('instances not found');
  return instances;
 }
 return shuffle(best);
};

const detectLanguage = (query, params) => {
 const allowedLanguages = params.get('languages');
 const languagesRaw = allowedLanguages ? allowedLanguages.split(',') : LANGUAGES;

 const all = 'all';
 const only = languagesRaw.filter(i => i !== all);
 console.log('allowed languages', languagesRaw);
 if (only.length === 0) return all;
 if (languagesRaw.length === 1) {
   const result = only[0];
   console.log('selected the only available language', result);
   return result;
 }

 const detected = detectAll(query, { only });
 console.log('detected languages', JSON.stringify(detected));

 const ranked = detected
  .filter(i => i.accuracy > 0.01)
  .sort((a, b) => b.accuracy - a.accuracy);

 const result = ranked[0]?.lang || (languagesRaw.length > only.length ? all : only[0]);
 console.log('selected language', result);
 return result;
};

const shuffle = xs => {
 for (let i = xs.length - 1; i > 0; i--) {
  let j = Math.floor(Math.random() * (i + 1));
  [xs[i], xs[j]] = [xs[j], xs[i]];
 }
 return xs;
};

const redirect = async (params, shuffledInstances, queryFromForm) => {
 window.removeEventListener('hashchange', main);
 window.location.hash = '';

 document.body.innerHTML = '<div id="message" class="pale"></div>';
 const messageElement = document.querySelector('#message');

 const targetUrl = new URL(shuffledInstances[0]);
 targetUrl.pathname = '/search';

 const newParams = new Map;
 params
  .entries()
  .filter(([k, _]) => !CUSTOM_PARAMS.includes(k))
  .forEach(([k, v]) => newParams.set(k, v));

 const query = queryFromForm || params.get('q') || '';
 console.log(`query "${query}"`);
 newParams.set('language', params.get('language') || detectLanguage(query, params));
 newParams.set('q', query);
 newParams.set('safesearch', params.get('safesearch') || '0');
 newParams.set('image_proxy', params.get('image_proxy') || 'True');

 const timeout = Number(params.get('timeout')) || TIMEOUT;
 const getMethod = params.get('get') === '1';
 for (let i = 0; i < shuffledInstances.length; i++) schedule(_ => {
  window.stop();
  if (i > 0) {
   const searxngRedirectorStats = JSON.parse(localStorage.getItem(STATS_KEY) || '{}');
   const stats = searxngRedirectorStats[new URL(shuffledInstances[i - 1]).hostname] || { ok: 0, failures: 0, ttl: 0 };
   stats.failures++;
   stats.ttl = currentTime() + STATS_TTL_SECS;

   const newValue = Object.fromEntries(Object.entries(searxngRedirectorStats)
    .filter(([_k, v]) => v.ttl > currentTime()));
   console.log('updating SearXNG redirector stats', newValue);
   localStorage.setItem(STATS_KEY, JSON.stringify(newValue));
  }

  const retryTargetUrl = new URL(targetUrl.toString());
  retryTargetUrl.host = new URL(shuffledInstances[i]).host;
  if (i > 0) {
   messageElement.innerHTML = `Attempt ${i + 1}/${shuffledInstances.length}: ${retryTargetUrl.host}`;
  }
  if (getMethod) {
   newParams.forEach((value, key) => retryTargetUrl.searchParams.set(key, value));
   const href = retryTargetUrl.toString();
   console.log('get', href);
   if (queryFromForm) {
    window.location.href = href;
   } else {
    window.location.replace(href);
   }
  } else {
   retryTargetUrl.hash = new URLSearchParams(newParams).toString();
   const href = retryTargetUrl.toString();
   console.log('post', href);
   const form = document.createElement('form');
   form.method = 'POST';
   form.action = href;
   newParams.forEach((value, key) => {
    const input = document.createElement('input');
    input.type = 'hidden';
    input.name = key;
    input.value = value;
    form.appendChild(input);
   });
   document.body.appendChild(form);
   form.submit();
   document.body.removeChild(form);
  }
 }, i * timeout);

 schedule(_ => messageElement.innerHTML = 'Failed', shuffledInstances.length * timeout);
};

const main = async _ => {
 const params = new URLSearchParams(window.location.hash.split('#')[1] || '');
 const shuffledInstances = await loadAndShuffleInstances(params);
 console.log('will be trying instances', shuffledInstances);

 if (params.has('q')) {
  redirect(params, shuffledInstances);
 } else {
  document.body.innerHTML = '';

  const input = document.createElement('input');
  input.name = 'q';
  input.placeholder = 'Search for...';
  input.autocomplete = 'off';
  input.autocapitalize = 'none';
  input.spellcheck = false;
  input.autocorrect = 'off';
  input.dir = 'auto';
  input.style.borderWidth = '0.15rem';
  input.style.fontSize = '1.5rem';
  input.style.margin = '2rem 0 1.5rem 0';
  input.style.width = '99%';

  const form = document.createElement('form');
  form.addEventListener('submit', event => {
   event.preventDefault();
   redirect(params, shuffledInstances, input.value);
  });

  form.appendChild(input);
  document.body.appendChild(form);
  input.focus();

  const pageUrl = `${window.location.protocol}//${window.location.pathname}`;
  const div = document.createElement('div');
  div.innerHTML = `
<p>This page redirects to a <a rel="noopener noreferrer nofollow" href="${pageUrl}#q=" onclick="window.location.replace('${pageUrl}#q=')">random SearXNG</a> instance.</p>
<hr>
<p>Examples for <strong>browser search engine settings</strong> (<code>about:preferences#search</code> or <code>chrome://settings/search</code>):</p>
<ul>
 <li><code>${pageUrl}#q=%s&languages=all,en,fr,ru</code></li>
 <li><code>${pageUrl}#q=%s&fast=1&image_proxy=False&categories=images,videos&languages=all,en,fr,ru&get=1</code></li>
</ul>
<p>Supports the following parameters (provided as an anchor for privacy):</p>
<ul>
 <li>normal SearXNG GET/POST <a rel="noopener" target="_blank" href="https://docs.searxng.org/dev/search_api.html">parameters</a> (<code>safesearch=0</code> and <code>image_proxy=True</code> are set by default)</li>
 <li><code>languages</code> limit query-based language detection, fallbacks to the first language in the list when not detected (use <code>all</code> to fallback to SearXNG-based language detection instead); comma-separated, default is <code>${LANGUAGES.join(',')}</code></li>
 <li><code>get</code> pass parameters to the instance using GET method; default is <code>0</code></li>
 <li><code>timeout</code> in milliseconds until attempting the next instance; default is <code>${TIMEOUT}</code></li>
 <li><code>attempts</code> how many instances to try; default is <code>${ATTEMPTS}</code></li>
 <li><code>fast</code> always use the predefined SearXNG instances rather than just as a fallback (no <a rel="noopener" target="_blank" href="${INSTANCES_URL}">API</a> will be used); default is <code>0</code></li>
 <li><code>instances</code> the predefined instances (use <code>fast=1</code> to force the use of them); comma-separated, default is <code>${INSTANCES.join(',')}</code></li>
</ul>
${pageUrl.startsWith('file:') ? '' : `<p>For local use (doesn't require any server): <code>wget ${pageUrl} -O searxng.html</code></p>`}
<p>Additionally can be combined with the Violentmonkey userscripts:</p>
<ul>
 <li><a rel="noopener" target="_blank" href="https://userscripts.codonaft.com/redirect-searxng-on-failure.js">redirect-searxng-on-failure.js</a> — turn search failures into the redirects</li>
 <li><a rel="noopener" target="_blank" href="https://userscripts.codonaft.com/force-searxng-parameters.js">force-searxng-parameters.js</a> — always enable image proxy and disable SafeSearch</li>
</ul>
<hr>
<p>Existing alternatives:</p>
<ul>
 <li><a rel="noopener" target="_blank" href="https://searx.neocities.org/">Neocities</a></li>
 <li><a rel="noopener" target="_blank" href="https://github.com/demostanis/gimmeasearx">gimmeasearx</a></li>
</ul>`;
  document.body.appendChild(div);
 }
};

window.addEventListener('hashchange', main);
window.addEventListener('pageshow', event => {
 if (!event.persisted) return;

 console.log('back button is probably pressed');
 cancelTasks();
 window.removeEventListener('hashchange', main);
 window.addEventListener('hashchange', main);
 main();
});
main();
</script>
</body>
</html>
