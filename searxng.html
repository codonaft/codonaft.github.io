---
permalink: /searxng
---

<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<link rel="icon" href="https://searx.space/favicon.png" sizes="any">
<link rel="icon" href="https://searx.space/favicon.svg" type="image/svg+xml">
<link rel="apple-touch-icon" href="https://searx.space/favicon.png">
<title>SearXNG Random Instance Redirector</title>
<style>
code { background-color: rgba(128, 128, 128, 0.4); padding: 0.1rem 0.25rem 0.1rem 0.25rem }
.pale { color: #808080 }
</style>
</head>
<body>
<script type="module">
import { detectAll } from '{{ site.url }}/assets/js/vendor/tinyld.min.js';

const INSTANCES = ['search.charliewhiskey.net', 'search.im-in.space', 'search.ipsys.bf', 'search.mycotrip.tech', 'search.ononoki.org', 'search.pollorebozado.com', 'search.rowie.at', 'search.system51.co.uk', 'search.undertale.uk', 'search.url4irl.com', 'searx.bndkt.io', 'searx.dresden.network', 'searx.foss.family', 'searx.oloke.xyz', 'searx.ox2.fr', 'searx.party', 'searx.perennialte.ch', 'searx.tiekoetter.com', 'searx.zhenyapav.com', 'searxng.shreven.org']
const LANGUAGES = ['en'];
const TIMEOUT = 5000;
const ATTEMPTS = 10;
const CUSTOM_PARAMS = ['attempts', 'languages', 'fast', 'instances', 'timeout'];

const loadAndShuffleInstances = async params => {
 const attempts = Number(params.get('attempts')) || ATTEMPTS;
 const instancesFromParams = params.get('instances')?.split(',') || [];
 const instances = shuffle((instancesFromParams.length > 0 ? instancesFromParams : INSTANCES))
  .slice(0, attempts)
  .map(i => {
   const protocol = i.endsWith('.onion') ? 'http' : 'https';
   return `${protocol}://${i}/`;
  });
 if (params.get('fast') === '1') return instances;

 const response = await fetch('https://searx.space/data/instances.json');
 if (!response.ok) {
  console.log('failed to load instances');
  return instances;
 }

 const loadedInstances = (await response.json()).instances;
 console.log('instances', loadedInstances);

 const onion = window.location.host.endsWith('.onion');
 const best = Object
  .entries(loadedInstances)
  .filter(([u, i]) => {
   try {
    const url = new URL(u);
    if (onion) {
     if (i?.network_type !== 'tor') return false;
    } else {
     if (i?.network_type !== 'normal' || url.protocol !== 'https:' || i?.tls?.grade !== 'A+' || i?.html?.grade !== 'V') return false;
    }
    return !i?.analytics;
   } catch(e) {
    console.error(e);
    return false;
   }
  })
  .map(([u, i]) => {
    const key = [i?.uptime?.uptimeDay, i?.uptime?.uptimeMonth, 1 / i?.engines?.google?.error_rate, 1 / i?.engines?.duckduckgo?.error_rate];
    return [u, key];
  })
  .sort(([_a, a], [_b, b]) =>  {
   const index = a.findIndex((_, i) => (a[i] || 0) !== (b[i] || 0));
   if (index === -1) return 0;
   return b[index] - a[index];
  })
  .map(([u, _]) => u)
  .slice(0, attempts);

 console.log('best', best);
 if (best.length === 0) {
  console.log('instances not found');
  return instances;
 }
 return shuffle(best);
};

const detectLanguage = (query, params) => {
 const en = 'en';
 const allowedLanguages = params.get('languages');
 const only = allowedLanguages ? allowedLanguages.split(',') : LANGUAGES;
 console.log('allowed languages', only);
 if (only.length <= 1) return en;

 const all = detectAll(query, { only });
 console.log('detected languages', all);

 const detected = all
  .filter(i => i.accuracy > 0.01)
  .sort((a, b) => b.accuracy - a.accuracy);
 if (detected.length === 0) return en;

 return detected[0].lang;
};

const shuffle = xs => {
 for (let i = xs.length - 1; i > 0; i--) {
  let j = Math.floor(Math.random() * (i + 1));
  [xs[i], xs[j]] = [xs[j], xs[i]];
 }
 return xs;
};

const redirect = async (params, queryFromForm) => {
 document.body.innerHTML = '<div id="message" class="pale"></div>';
 const messageElement = document.querySelector('#message');

 const shuffledInstances = await loadAndShuffleInstances(params);
 console.log('will be trying instances', shuffledInstances);

 const targetUrl = new URL(shuffledInstances[0]);
 targetUrl.pathname = '/search';
 targetUrl.searchParams.set('safesearch', params.get('safesearch') || '0');

 params
  .entries()
  .filter(([k, _]) => !CUSTOM_PARAMS.includes(k))
  .forEach(([k, v]) => targetUrl.searchParams.set(k, v));

 const query = queryFromForm || params.get('q') || '';
 targetUrl.searchParams.set('language', detectLanguage(query, params));
 targetUrl.searchParams.set('q', query);

 const timeout = Number(params.get('timeout')) || TIMEOUT;
 for (let i = 0; i < shuffledInstances.length; i++) setTimeout(_ => {
  window.stop();
  const retryTargetUrl = new URL(targetUrl.toString());
  retryTargetUrl.host = new URL(shuffledInstances[i]).host;
  if (i > 0) {
   messageElement.innerHTML = `Attempt ${i + 1}/${shuffledInstances.length}: ${retryTargetUrl.host}`;
  }
  const href = retryTargetUrl.toString();
  console.log('trying', href);
  if (queryFromForm) {
   window.location.href = href;
  } else {
   window.location.replace(href);
  }
 }, i * timeout);

 setTimeout(_ => messageElement.innerHTML = 'Failed', shuffledInstances.length * timeout);
};

const main = _ => {
 const params = new URLSearchParams(window.location.hash.split('#')[1] || '');
 if (params.has('q')) {
  redirect(params);
 } else {
  const pageUrl = window.location.origin + window.location.pathname;
  document.body.innerHTML = `<p>This page redirects to a <a rel="noopener noreferrer nofollow" href="${pageUrl}#q=" onclick="window.location.replace('${pageUrl}#q=')">random SearXNG</a> instance.</p><p>It also supports the <a rel="noopener noreferrer nofollow" target="_blank" href="https://docs.searxng.org/dev/search_api.html">GET parameters</a> (provided as an anchor for privacy) and the optional parameters:<p><p><ul><li><code>languages=en,fr,ru</code> to use automatic language filter derived from the query; default is <code>${LANGUAGES.join(',')}</code></li><li><code>fast=1</code> to force use of predefined instances (instead of fetching them using the <a rel="noopener noreferrer nofollow" target="_blank" href="https://searx.space/data/instances.json">API</a>); default is <code>0</code></li><li><code>instances=search.ononoki.org,searx.bndkt.io</code> to predefine the instances; default is <code>${INSTANCES.join(',')}</code></li><li><code>timeout</code> in milliseconds until attempting the next instance; default is <code>${TIMEOUT}</code></li><li><code>attempts</code> how many instances to try; default is <code>${ATTEMPTS}</code></li></ul></p><p>Example for <strong>browser search engine settings</strong> (<code>about:preferences#search</code> or <code>chrome://settings/search</code>): <code>${pageUrl}#q=%s&fast=1&image_proxy=True&categories=images&languages=en,fr,ru</code>.</p><p>For local use: <code>wget ${pageUrl} -O searxng.html</code>.</p><p>Additionally can be combined with the Violentmonkey <a rel="noopener noreferrer nofollow" target="_blank" href="https://userscripts.codonaft.com/searxng-redirect-on-failure.js">userscript</a> to turn search failures into redirects as well.</p>`;

  const input = document.createElement('input');
  input.name = 'q';
  input.placeholder = 'Search for...';
  input.autocomplete = 'off';
  input.autocapitalize = 'none';
  input.spellcheck = false;
  input.autocorrect = 'off';
  input.dir = 'auto';
  input.style.width = '99%';

  const form = document.createElement('form');
  form.addEventListener('submit', event => {
   event.preventDefault();
   redirect(params, input.value);
  });

  form.appendChild(input);
  document.body.appendChild(form);
 }
};

window.addEventListener('hashchange', main);
main();

</script>
</body>
</html>
